{% extends "layout/base.html" %}
{% load static %}
{% block 'content' %}
<div class="grid grid-cols-3 gap-4 mt-5 sm:grid-cols-3 md:gap-6">
  <!-- Metric Item Start -->
  <div
    class="rounded-box border-2 border-base-300 bg-base-100 p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6"
  >
    <div
      class="flex h-12 w-12 items-center justify-center rounded-xl text-success"
    >
	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-9 text-success">
		<path fill-rule="evenodd" d="M9 1.5H5.625c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5Zm6.61 10.936a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 14.47a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
	<path d="M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z" />
	</svg>



    </div>

    <div class="mt-3 flex items-end justify-between">
      <div>
        <span class="text-md text-base-content">Tasks Completed</span>
        <h4 class="mt-2 text-3xl font-bold text-base-content/90">3,782</h4>
      </div>
    </div>
  </div>
  <!-- Metric Item End -->

   {% comment %} Pending {% endcomment %}
  <div
    class="rounded-2xl border-2 border-base-300 bg-base-100 p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6"
  >
    <div
      class="flex h-12 w-12 items-center justify-center rounded-xl bg-base-100"
    >
	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-9 text-warning">
		<path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z" clip-rule="evenodd" />
	</svg>




    </div>

    <div class="mt-3 flex items-end justify-between">
      <div>
        <span class="text-md text-base-content">Tasks Pending</span>
        <h4 class="mt-2 text-3xl font-bold text-base-content/90">3,782</h4>
      </div>
    </div>
  </div>

   {% comment %} Missed {% endcomment %}
  <div
    class="rounded-2xl border-2 border-base-300 bg-base-100 p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6"
  >
    <div
      class="flex h-12 w-12 items-center justify-center rounded-xl bg-base-100"
    >
	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-9 text-error">
		<path d="M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375Z" />
		<path fill-rule="evenodd" d="m3.087 9 .54 9.176A3 3 0 0 0 6.62 21h10.757a3 3 0 0 0 2.995-2.824L20.913 9H3.087Zm6.133 2.845a.75.75 0 0 1 1.06 0l1.72 1.72 1.72-1.72a.75.75 0 1 1 1.06 1.06l-1.72 1.72 1.72 1.72a.75.75 0 1 1-1.06 1.06L12 15.685l-1.72 1.72a.75.75 0 1 1-1.06-1.06l1.72-1.72-1.72-1.72a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
	</svg>




    </div>

    <div class="mt-3 flex items-end justify-between">
      <div>
        <span class="text-md text-base-content">Tasks Missed</span>
        <h4 class="mt-2 text-3xl font-bold text-base-content/90">3,782</h4>
      </div>
    </div>
  </div>
</div>
{% comment %} end metrics {% endcomment %}
<div class="my-8 border border-base-300 rounded-2xl p-5 shadow-2xl">
  <div class="grid grid-cols-3 gap-6 h-[675px]">
    <!-- First row: Headings -->
    <div class="flex items-center">
    </div>
    <div class="col-span-2 flex items-center">
      <!-- Optionally, you can put a calendar heading here, or leave empty for alignment -->
    </div>
    <!-- Second row: Content -->
    <div class="flex flex-col gap-3 overflow-y-auto max-h-full">
      <div class="sticky top-0 z-10 bg-base-100 pb-2">
        <h1 class="text-2xl font-bold">Tasks List</h1>
      </div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>
      <div class="bg-primary p-5 rounded-2xl max-h-20 flex items-center">ambot</div>


      <!-- ...more tasks... -->
    </div>
    <div class="col-span-2">
      <div id="calendar" class="h-full"></div>
    </div>
  </div>
</div>
<script src="{% static 'js/calendar.js' %}"></script>


{% include "task/taskAddModal.html" %}

<script>
const staffData = {{ staff_by_role_json|safe }}; // Pass this from your Django view as a JSON dict: {role_id: [{id, name}, ...]}
function updateStaffOptions(roleSelect) {
  const staffSelect = roleSelect.closest('.staff-role-row').querySelector('.staff-select');
  const roleId = roleSelect.value;
  staffSelect.innerHTML = '<option value="">Select Staff</option>';
  if (roleId && staffData[roleId]) {
    staffData[roleId].forEach(staff => {
      const opt = document.createElement('option');
      opt.value = staff.id;
      opt.textContent = staff.name;
      staffSelect.appendChild(opt);
    });
  }
}

document.addEventListener('change', function(e) {
  if (e.target.classList.contains('role-select')) {
    updateStaffOptions(e.target);
  }
});

document.getElementById('add-staff-role-btn').addEventListener('click', function() {
  const container = document.getElementById('staff-role-container');
  const firstRow = container.querySelector('.staff-role-row');
  const newRow = firstRow.cloneNode(true);
  // Reset selects
  newRow.querySelector('.role-select').selectedIndex = 0;
  const staffSelect = newRow.querySelector('.staff-select');
  staffSelect.innerHTML = '<option value="">Select Staff</option>';
  container.appendChild(newRow);
  updateRemoveButtons();
});

function updateRemoveButtons() {
    const rows = document.querySelectorAll('.staff-role-row');
    rows.forEach(row => row.querySelector('.remove-row-btn').classList.add('hidden'));
    if (rows.length > 1) {
        rows.forEach(row => row.querySelector('.remove-row-btn').classList.remove('hidden'));
    }
}

// Remove row on X button click
document.getElementById('staff-role-container').addEventListener('click', function(e) {
    if (e.target.closest('.remove-row-btn')) {
        const row = e.target.closest('.staff-role-row');
        row.remove();
        updateRemoveButtons();
    }
});

// Initial call to set remove button visibility
updateRemoveButtons();
</script>


{% endblock 'content' %}